<!DOCTYPE html>
<html>
    <HEAD>

<style> 
body {
    background-color: black;
    font-family: "Comic Sans MS", "Comic Sans", "Times New Roman", Times, serif;
}

#title {
    text-align: center; 
    color:#777;
    font-size: 36px;
    font-weight: bold;
    horizontal-align: center;
}

#films_box_genre {
    //background: #b2ffb2;
}
#films_box_theme {
    //background: #d8b2ff;
}
#films_box_director {
    //background: #b2e1ff;
}
#films_box_actor {
    //background: #b2e1ff;
}
#films_box_best {
    //background: #b2e1ff;
}
#films_box_new {
    //background: #b2e1ff;
}
#films_box_favorite {
    //background: #b2e1ff;
}
#films_box_all {
    //background: #b2e1ff;
}
#films_container {
//    width: 100%;
//    text-align: center;
//    border: 0px solid green;
}

.dropdown{
    font-family: "Comic Sans MS", "Comic Sans", "Times New Roman", Times, serif;
    font-size: 14px;
}
    
.categorybox {
  background : red;
  padding: 0px;
  border: 0px;
  width: 170px;
  height: 100px;
  border: 2px solid darkgray;
}  

.upper-button {
  background : lightgray;
  height: 100%;
  text-align: center;
  font-size: 26px;
  font-weight: bold;
  color:black;
  line-height: 100px;
}

.dropdown {
  background : lightgray;
  width:100%;
  //vertical-align: middle;
  position:relative;
  top:-105px;
  left:0px;
  border: 0px;
  align: center;
} 

.dropdown-wrapper {
    padding-right: 0px;
    padding-left: 0px;
} 

table{border-spacing:0;}

table td { padding:2px;}

a {
    text-decoration: none;
    cursor:pointer;
}

</style>
    <script type="text/javascript" src="js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="js/jquery.i18n.properties-min-1.0.9.js"></script>
	<script type="text/javascript">

        var language = new URLSearchParams(window.location.search).get("language");
         
	    jQuery(document).ready(function() {
            readTranslation(language);
            fillUpDropdowns( "cgi-bin/collect_category.py" )
	    });

	    function fillUpDropdowns( app ){            
            
            fillUpDropdown( app,
                {
                    "section":"general",
                    "key": "genre",
                    "search": "a"
                }, 'genre_' );

            fillUpDropdown( app,
                {
                    "section":"general",
                    "key": "theme",
                    "search": "a"
                }, 'theme_' );

            fillUpDropdown( app,
                {
                    "section":"general",
                    "key": "director",
                    "search": "a"
                }, null );

            fillUpDropdown( app,
                {
                    "section":"general",
                    "key": "actor",
                    "search": "a"
                }, null );
        }
        
  	    function fillUpDropdown( app, data, dict_key ){

            $.ajax({
                url: app,
                data: data,
 //               method: 'GET',
                contentType: 'application/json',
                dataType : "json",
                success: function(list) {
                
                    $.each(list, function(i, value) {
                        transl = (dict_key && value) ? $.i18n.prop( dict_key + value) : value;
                        $("#dropdown-" + data['key'] ).append('<option value="' + value + '">' + transl + '</option>');
                    });
                    
                    sortMeBy("select#dropdown-" + data['key'], "option", "asc");
                     $("#dropdown-" + data['key'])[0].selectedIndex = 0;
                },
                error: function(list,status,req){
                    alert(data['key'] + " error: " + status + "\n" + req + "\n" + list + "\nHat ez baj");
                }
            });
        }
	    	 
        function sortMeBy(sel, elem, order) {
                var $selector = $(sel),
                $element = $selector.children(elem);
                $element.sort(function(a, b) {
                        //var an = parseInt(a.getAttribute(arg)),
                        //bn = parseInt(b.getAttribute(arg));
                        var an = a.text;
                        bn = b.text;

                        if (order == "asc") {
                                if (an > bn)
                                return 1;
                                if (an < bn)
                                return -1;
                        } else if (order == "desc") {
                                if (an < bn)
                                return 1;
                                if (an > bn)
                                return -1;
                        }
                        return 0;
                });
                $element.detach().appendTo($selector);
        }	    	 
	    	 
	    function readTranslation(l){
            language = l;
            $.i18n.properties({ 
                name: 'resources', 
                path: 'bundle/',
                mode: 'both', 
                language: l, 
                async: true,
                callback: function() { 

                    $("#title").text($.i18n.prop('title_films')); 

                    $("#films_box_genre").text($.i18n.prop('title_genre')); 
                    $("#films_box_theme").text($.i18n.prop('title_theme')); 
                    $("#films_box_director").text($.i18n.prop('title_director')); 
                    $("#films_box_actor").text($.i18n.prop('title_actor')); 
                    $("#films_box_best").text($.i18n.prop('title_best')); 
                    $("#films_box_new").text($.i18n.prop('title_new')); 
                    $("#films_box_favorite").text($.i18n.prop('title_favorite')); 
                    $("#films_box_all").text($.i18n.prop('title_all')); 			
                }
            });
	    };

   	    function clickCategory(category, key_dict_prefix, value_dict_prefix){
            selectedCategory = $('#dropdown-' + category).find(":selected").val();
            if( selectedCategory && selectedCategory != "" ){
                window.location.href="list.html?key=" + category + "&value=" + selectedCategory + "&key_dict_prefix=" + key_dict_prefix+ "&value_dict_prefix=" + value_dict_prefix + "&search=a&show_value=y&language=" + language
            }
        }
            
        function fireClickOnA(selection, event, linkId){
            if( selection != 0 ){
                //clickCategory(category, key_dict_prefix, value_dict_prefix)
                //$( linkId ).trigger('click');
                $( linkId ).click();                
            }
        }       
        
	</script>
    </HEAD>

    <BODY>
 
        <div id="title"></div>

        <div style="margin-left: 20px; margin-bottom: 20px;" id="langBox">
            Language:
            <select id="lang" onchange="readTranslation(this.value)">
                <option value="en">en</option>
                <option value="hu" selected >hu</option>
                <option value="se">se</option>
            </select>
        </div>

        <div id="films_container">
        
        
        
        
    
   
        <table ALIGN="CENTER">
            
            <tr>
                <td>
                    <div class="categorybox">
                        <a id="a-genre" onclick="clickCategory('genre', 'title_', 'genre_')">
                            <div id="films_box_genre" class="upper-button">
                            </div>                
                        </a> 
                        <div class="dropdown-wrapper">
                            <select id="dropdown-genre" class="dropdown" onchange="fireClickOnA(this, event, '#a-genre')">
                            </select>
                        </div>
                    </div>                
                </td>
                
                
                <td>
                    <div class="categorybox">
                        <a id="a-theme" onclick="clickCategory('theme', 'title_', 'theme_')">
                            <div id="films_box_theme" class="upper-button">
                            </div>                
                        </a> 
                        <div class="dropdown-wrapper">
                            <select id="dropdown-theme" class="dropdown" onchange="fireClickOnA(this, event, '#a-theme' )">
                            </select>
                        </div>
                    </div>                
                </td>

                <td>
                    <div class="categorybox">
                        <a id="a-director" onclick="clickCategory('director', 'title_', 'null')">
                            <div id="films_box_director" class="upper-button">            
                            </div>                
                        </a> 
                        <div class="dropdown-wrapper">
                            <select id="dropdown-director" class="dropdown" onchange="fireClickOnA(this, event, '#a-director')">
                            </select>
                        </div>
                    </div>                
                </td>

                <td>
                    <div class="categorybox">
                        <a id="a-actor" onclick="clickCategory('actor', 'title_', 'null')"> 
                            <div id="films_box_actor" class="upper-button">
                            </div>                
                        </a> 
                        <div class="dropdown-wrapper">
                            <select id="dropdown-actor" class="dropdown" onchange="fireClickOnA(this, event, '#a-actor')">
                            </select>
                        </div>
                    </div>                
                </td>
            </tr>
            
                       

            <tr>
                <td>
                    <div class="categorybox">
                        <a id="a-all" href="javascript:self.location.href='list.html?key=all&value=y&key_dict_prefix=title_&value_dict_prefix=null&search=*&show_value=n&language=' + language">
                            <div id="films_box_all" class="upper-button">
                            </div>                
                        </a> 
                    </div>                
                </td>

                <td>
                    <div class="categorybox">
                        <a id="a-best" href="javascript:self.location.href='list.html?key=best&value=y&key_dict_prefix=title_&value_dict_prefix=null&search=v&show_value=n&language=' + language">
                            <div id="films_box_best" class="upper-button">
                            </div>                
                        </a> 
                    </div>                
                </td>
                
                <td>
                    <div class="categorybox">
                        <a id="a-new" href="javascript:self.location.href='list.html?key=new&value=y&key_dict_prefix=title_&value_dict_prefix=null&search=v&show_value=n&language=' + language">
                            <div id="films_box_new" class="upper-button">
                            </div>                
                        </a> 
                    </div>                
                </td>

                <td>
                    <div class="categorybox">
                        <a href="javascript:self.location.href='list.html?key=favorite&value=y&key_dict_prefix=title_&value_dict_prefix=null&search=v&show_value=n&language=' + language">
                            <div id="films_box_favorite" class="upper-button">                                
                            </div>                
                        </a> 
                    </div>                
                </td>
                
            </tr>           
            
        
       </div>
    </BODY>
</html>
