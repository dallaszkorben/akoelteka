<!DOCTYPE html>
<html>
    <HEAD>

<style> 
body {
    background-color: black;
    font-family: "Comic Sans MS", "Comic Sans", "Times New Roman", Times, serif;
    padding: 10px;
}

#title {
    text-align: center; 
    color:#777;
    font-size: 36px;
    font-weight: bold;
    horizontal-align: center;
}


#movie_card_container {
    font-size: 12px;
    font-weight: normal;
    vertical-align: middle;
    horizontal-align:left;
    padding: 3px;
    padding-right: 20px;
    padding-left: 20px;
    background-color: gray;
    
}

.movie_card_table {
    padding: 3px;                   // to decrease the image and info to not to overlap the rounding;    
    margin-top:3px;                 // distance from the other cards;
    margin-bottom:3px;    
    border-radius: 5px;
    border-style: solid;
    border-width: 1px;
    border-color: white;    
    background-color: lightgray;
}

.movie_card_table_row {
    display: table-row;             // tr
}

.movie_card_image {
    display: table-cell;            // td
    background-color: yellow;
    padding: 0px;
    
    text-align: center;
    vertical-align: middle;
    height: 160px;
    background-color: black;
    cursor:pointer;
}

.movie_card_image img{
    width: 160px;
}

.movie_card_info {
    display: table-cell;     
    width: 100%;
    padding: 10px;    
    background-color: lightgray;
}

.movie_card_info_title {
    font-size: 20px;
    font-weight: bold;
}
.movie_card_info_details {
    padding-left: 0px;
}


</style>

    <script type="text/javascript" src="js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="js/jquery.i18n.properties-min-1.0.9.js"></script>
    <script type="text/javascript" src="js/common.js"></script>

	<script type="text/javascript">

        // Read positional parameters from the previous page
        var f_key = new URLSearchParams(window.location.search).get("key");
        var f_value = new URLSearchParams(window.location.search).get("value");
        var f_key_dict_prefix = new URLSearchParams(window.location.search).get("key_dict_prefix");
        var f_value_dict_prefix = new URLSearchParams(window.location.search).get("value_dict_prefix");
        var f_search = new URLSearchParams(window.location.search).get("search");
        var f_show_value = new URLSearchParams(window.location.search).get("show_value");
        f_value_dict_prefix = (f_value_dict_prefix == "null") ? null : f_value_dict_prefix;
        
        readConfigFile();
        
        jQuery(document).ready(function() {
            readTranslation();
            collectCards(
                "cgi-bin/read_films.py", 
                { 
                    "root-dir" : pathFilm,
                    "key" : f_key, 
                    "value" : f_value,
                    "search" : f_search
                });
	    });
	    
        function dic( word ){	    
            //trans = dict[ word ]
            trans = $.i18n.map[word]
            if( trans == undefined ){
                trans = "[" + word + "]";
            }	    
            return trans
	    }
	    
		function collectCards(app, param) {
            $.ajax({
                url: app,
                data: param,
                method: 'GET',
                contentType: 'json',
                dataType : "json",
                success: function(data) {
                    $.each(data, function(i, value) {
                        fill_up_one_card(i, value)
                    })
                },
                error: function(data,status,req){
                    alert("source: list.html/collectCards(app, param)\n" + "error: " + req );
                }
            });
        }

        function fill_up_one_card(i, value){
            content = "";
            //content += "<div class='movie_card_container'>  ";
            content += "    <div class='movie_card_table'>";
            content += "        <div class='movie_card_table_row'>";
                                    // picture container
            content += "            <div class='movie_card_image' onclick='playMedia(\"" + value.media + "\")'>";
            content += "                <img " + ((value.image) ? "src='" + value.image + "'" : "") + " />";
            content += "            </div>";
                                    // info container
            content += "            <div class='movie_card_info'>";
            
            content += "        <div class='movie_card_info_title'>" + value.title[language] + " - " + value.year + "</div>";
            content += "        <div class='movie_card_info_details'>";
            
            content += "            " + dic('title_length') + ": " + value.length + "<br>";
            content += "            " + dic('title_director') + ": ";            
            first = true;
           
           value.director.forEach( function(item){
                content += (first ? '' :', ') + item;
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_actor') + ": ";
            first = true;
            value.actor.forEach( function(item){
                content += (first ? '' :', ') + item;
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_sound') + ": ";
            first = true;
            value.sound.forEach( function(item){
                sndlng = ( item ) ? dic('lang_' + item) : ""
                content += (first ? '' :', ') + sndlng;
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_sub') + ": ";
            first = true;
            value.sub.forEach( function(item){
                sublng = (item) ? dic('lang_' + item) : ""
                content += (first ? '' :', ') + sublng;
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_genre') + ": ";
            first = true;
            value.genre.forEach( function(item){
                content += (first ? '' :', ') + dic('genre_' + item);
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_theme') + ": ";
            first = true;
            value.theme.forEach( function(item){
                theme = ( item ) ? dic('theme_' + item) : ""
                content += (first ? '' :', ') + theme;
                first = false;
            });
            content += "<br>";
            
            content += "            <a href='" + value.links.imdb + "'>imdb</a>"; 
            
            content += "            </div>";
            content += "        </div>";
            content += "    </div>";
            //content += "</div>";

   
            $("#movie_card_container").append(content);
        }
        
        function playMedia(media){
            "cgi-bin/read_films.py", 
                $.ajax({
                    url: "cgi-bin/play_video.py",
                    data: {
                        "player": playerVideo,
                        "param" : playreVideoParam,
                        "media" : media
                    },
                    method: 'GET',
                    contentType: 'json',
                    dataType : "json"
            });
        }
		
	    function readTranslation(){	    
            $.i18n.properties({ 
                name: 'resources', 
                path: 'translation/',
                mode: 'both', 
                language: language, 
                async: true,
                callback: function() {

                    // Show Main Title
                    //trl_key = ($.i18n.prop( f_key_dict_prefix + f_key ));                    
                    //trl_value = ( ( f_show_value != "n" ) ? ": " + ((f_value_dict_prefix != null) ? $.i18n.prop( f_value_dict_prefix + f_value ):f_value) : "" );
                    trl_title = $.i18n.prop("title_selection_by") + ": "
                    trl_title += ($.i18n.prop( f_key_dict_prefix + f_key )) + ( ( f_show_value != "n" ) ? " = " + ((f_value_dict_prefix != null) ? $.i18n.prop( f_value_dict_prefix + f_value ):f_value) : "" );
                    
                    $("#title").text( trl_title );                 
                }
            });
	    };
	    
	</script>
    </HEAD>

    <BODY>
        <div id="title"></div><br>
        <div id="movie_card_container">
        </div>
    </BODY>
</html>
