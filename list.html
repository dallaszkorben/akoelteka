<!DOCTYPE html>
<html>
    <HEAD>

<style> 
body {
    background-color: black;
    font-family: "Comic Sans MS", "Comic Sans", "Times New Roman", Times, serif;
    padding: 10px;
}

#title {
    text-align: center; 
    color:#777;
    font-size: 36px;
    font-weight: bold;
    horizontal-align: center;
}

#movie_box_container {
    font-size: 12px;
    font-weight: normal;
    vertical-align: middle;
    horizontal-align:left;
    padding: 5px;
    padding-right: 20px;
    padding-left: 20px;
    background-color: gray;
}
.movie_box {
    display: block;
    width: auto;
    text-align: left;
    padding: 3px;
    margin: 3px;

    background-color: lightgray;
    border-radius: 5px;
    border-style: solid;
    border-width: 1px;
    border-color: white;
}

.movie_box_picture .bla{
    width: 160px;
    height: 160px;
}
.movie_box_picture {
    display: inline-block;
    
    background-color: black;
    
    border-style: solid;
    border-width: 1px;
    border-color: white;
    cursor:pointer;
#    width: 160px;
#    height: 160px;
}
.movie_box_picture img{
    width: 160px;
}

.bla {    
    display: table-cell;
    text-align: center;
#    width: 160px;
#    height: 160px;
    vertical-align: middle;
}

.movie_box_info {
    display: inline-block;
    vertical-align: top;

    margin-left: 6px;
    
    border-style: solid;
    border-width: 1px;
    border-color: white;
}
.movie_box_info_title {
    font-size: 20px;
    font-weight: bold;
}
.movie_box_info_details {
    padding-left: 0px;
}

</style>

    <script type="text/javascript" src="js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="js/jquery.i18n.properties-min-1.0.9.js"></script>
	<script type="text/javascript">

        // Read positional parameters from the previous page
        var language = new URLSearchParams(window.location.search).get("language");
        var f_key = new URLSearchParams(window.location.search).get("key");
        var f_value = new URLSearchParams(window.location.search).get("value");
        var f_key_dict_prefix = new URLSearchParams(window.location.search).get("key_dict_prefix");
        var f_value_dict_prefix = new URLSearchParams(window.location.search).get("value_dict_prefix");
        var f_search = new URLSearchParams(window.location.search).get("search");
        var f_show_value = new URLSearchParams(window.location.search).get("show_value");
        f_value_dict_prefix = (f_value_dict_prefix == "null") ? null : f_value_dict_prefix;
        
        function dic( word ){	    
            //trans = dict[ word ]
            trans = $.i18n.map[word]
            if( trans == undefined ){
                trans = "[" + word + "]";
            }	    
            return trans
	    }
	    
		function collectCards(app, param) {
            $.ajax({
                url: app,
                data: param,
 //               method: 'GET',
                contentType: 'application/json',
                dataType : "json",
                success: function(data) {
//                     //$('#list').append(data);
                    $.each(data, function(i, value) {
                        fill_up_one_card(i, value)
                    })
                },
                error: function(data,status,req){
                    alert("error: " + req + "\n Hello");
                }
            });
        }

        function fill_up_one_card(i, value){
            content = "";
            content += "<div class='movie_box'>";
            content += "    <div class='movie_box_picture' onclick='playMedia(\"" + value.media + "\")' >";
            content += "        <div class='bla'><img " + ((value.image) ? "src='" + value.image + "'" : "") + " /></div>";
            content += "    </div>";
            content += "    <div class='movie_box_info'>";
            content += "        <div class='movie_box_info_title'>" + value.title[language] + " - " + value.year + "</div>";
            content += "        <div class='movie_box_info_details'>";
            content += "            " + dic('title_length') + ": " + value.length + "<br>";
            content += "            " + dic('title_director') + ": ";            
            first = true;
            value.director.forEach( function(item){
                content += (first ? '' :', ') + item;
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_actor') + ": ";
            first = true;
            value.actor.forEach( function(item){
                content += (first ? '' :', ') + item;
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_sound') + ": ";
            first = true;
            value.sound.forEach( function(item){
                content += (first ? '' :', ') + dic('lang_' + item);
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_sub') + ": ";
            first = true;
            value.sub.forEach( function(item){
                content += (first ? '' :', ') + dic('lang_' + item);
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_genre') + ": ";
            first = true;
            value.genre.forEach( function(item){
                content += (first ? '' :', ') + dic('genre_' + item);
                first = false;
            });
            content += "<br>";
            
            content += "            " + dic('title_theme') + ": ";
            first = true;
            value.theme.forEach( function(item){
                content += (first ? '' :', ') + dic('theme_' + item);
                first = false;
            });
            content += "<br>";
            
            content += "            <a href='" + value.links.imdb + "'>imdb</a>";            
            content += "        </div>";
            content += "    </div>";
            content += "</div>";
            $("#movie_box_container").append(content);
        }
        
        function playMedia(media){
        "cgi-bin/read_films.py", 
            $.ajax({
                url: "cgi-bin/play_video.py",
                data: {
                    "media" : media
                },
 //               method: 'GET',
                contentType: 'application/json',
                dataType : "json"
            });
        }
		
	    function readTranslation(l){	    
		$.i18n.properties({ 
		    name: 'resources', 
		    path: 'bundle/',
		    mode: 'both', 
		    language: l, 
		    async: true,
		    callback: function() {

                // Show Main Title
                $("#title").text( ($.i18n.prop( f_key_dict_prefix + f_key )) + ( ( f_show_value != "n" ) ? ": " + ((f_value_dict_prefix != null) ? $.i18n.prop( f_value_dict_prefix + f_value ):f_value) : "" ) );                 

		    }
		 });
	    };
	    
   	    jQuery(document).ready(function() {
            readTranslation(language);
            collectCards(
                "cgi-bin/read_films.py", 
                { 
                    "key" : f_key, 
                    "value" : f_value,
                    "search" : f_search
                });
	    });
	    
	</script>
    </HEAD>

    <BODY>
        <div id="title"></div>
        <div id="movie_box_container">
        </div>
    </BODY>
</html>
